<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>G√©n√©rateur Sora 2 ‚Ä¢ Apple UI + OpenRouter</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700&display=swap" rel="stylesheet">
  <style>
    body {min-height:100vh;margin:0;background:linear-gradient(120deg,#f6faff 0%,#e3eafc 100%);font-family:'Inter','SF Pro',-apple-system,BlinkMacSystemFont,Arial,sans-serif;color:#172237;}
    .header {padding:2.3em 0 .5em 0;text-align:center;font-weight:700;font-size:2.1em;color:#161c27;margin-bottom:.5em;}
    .section {margin:2.6em auto 0 auto;max-width:400px;width:97vw;border-radius:2.3em;box-shadow:0 6px 42px 0 #b9ccee44,0 1.7px 8px #b7d5ec50;padding:2.1em 1.7em 2.5em 1.7em;background:rgba(248,251,255,0.83);backdrop-filter:blur(22px) saturate(1.25);border:1px solid rgba(212,225,241,0.38);position:relative;min-height:380px;animation:fadeInSlide .55s cubic-bezier(.6,.32,.08,1) both;}
    @keyframes fadeInSlide {from{opacity:0;transform:translateY(38px);}to{opacity:1;transform:none;}}
    .fadeOut {animation:fadeOutSlide .33s cubic-bezier(.3,1.3,.6,1) both;}
    @keyframes fadeOutSlide {from{opacity:1;transform:none;}to{opacity:0;transform:translateY(-30px);}}
    .stepnum {font-size:1em;letter-spacing:.04em;color:#70aaff;margin-bottom:1em;text-align:center;font-weight:600;}
    label {display:block;font-size:1.17em;color:#1e2c44;font-weight:700;margin-bottom:.7em;margin-top:1.2em;text-align:center;letter-spacing:.013em;}
    small {color:#6c83a0;font-size:.97em;display:block;margin:-.3em 0 .9em 0;text-align:center;}
    textarea,input {font-size:1.08em;width:100%;padding:1.03em 1em .95em 1em;border-radius:1.3em;border:1.7px solid #deebfe;background:rgba(255,255,255,0.55);box-shadow:0 2px 30px #e6f6ff1b;color:#18385d;margin-bottom:.65em;resize:none;outline:2px solid transparent;transition:.18s border;}
    textarea:focus, input:focus {border-color:#2673d8;outline:2px solid #bad5f7;}
    .suggestArea {display:flex; gap:0.75em; margin:.9em 0 .2em 0; flex-wrap:wrap; justify-content:center;}
    .suggestbtn {background:rgba(233,245,255,0.95);color:#2475d3;border-radius:1.6em;border:none;font-weight:700;font-size:1em;padding:.75em 1.25em;cursor:pointer;box-shadow:0 1.5px 11px #caf2ff25;transition:.14s background;border:1.2px solid #d0e8fe;margin-bottom:.35em;}
    .suggestbtn:hover {background:#239dfd;color:#fff;}
    .choiceList {margin:0.5em 0 .65em 0;padding-left:1em;list-style:disc;}
    .choiceList li {margin-bottom:.31em;cursor:pointer;font-size:1.09em;color:#1877f2;font-weight:600;padding:.18em .18em;border-radius:.6em;transition:background .13s;}
    .choiceList li:hover {background:rgba(33,148,255,.11);}
    .mainbtn, .prevbtn, .exportbtn {border-radius:2.6em;padding:1.05em 2.18em 1.13em 2.22em;font-size:1.13em;font-weight:700;border:none;cursor:pointer;letter-spacing:.003em;margin-top:.92em;margin-bottom:.45em;transition:background .17s, box-shadow .17s;}
    .mainbtn {background: linear-gradient(120deg,#1973f7 30%,#60afff 100%);color:#fff;box-shadow:0 2px 16px #1973f722;border:none;}
    .mainbtn:hover {background:#205ef5;}
    .prevbtn {background:rgba(230,243,254,0.80);color:#247ae7;border:1.5px solid #b1cdf7;margin-left:.7em;}
    .prevbtn:hover {background:#e1f2fe;color:#225aa3;}
    .exportbtn {background: linear-gradient(120deg,#2196f3 10%,#6bdcff 96%);color:#fff;box-shadow:0 1px 7px #3596e427;margin: 1.4em auto .7em auto; display:block;}
    .exportbtn:hover {background:#177ee5;}
    .navrow{display:flex;justify-content:center;gap:1em;margin-top:1.4em;}
    #resultSection {margin:auto;}
    .erroria {color:#b23e3e;font-size:.99em;text-align:center;display:block;}
    .icon-nav{display:inline-block;width:1.54em;vertical-align:-.25em;}
    @media(max-width:520px){.header{font-size:1.24em;} .section{margin-top:4vw;padding:4vw 1vw;}}
  </style>
</head>
<body>
<div class="header">G√©n√©rateur de prompt Sora 2</div>
<div>
  <div class="section" id="stepSection"></div>
  <div class="section hide" id="resultSection"></div>
</div>
<script>
// === REMPLACE par ta cl√© API OpenRouter (https://openrouter.ai/)
const OPENROUTER_KEY = "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";
const OPENROUTER_URL = "https://openrouter.ai/api/v1/chat/completions";
const OPENROUTER_MODEL = "meta-llama/llama-3-8b-instruct:nitro"; // Change pour autre mod√®le OpenRouter si tu veux

let steps = [
  { key:"idea",      label:"Id√©e de la sc√®ne", placeholder:"Ex: Un robot d√©couvre une ville sous-marine...", info:"D√©crivez le concept de la sc√®ne.", suggest:"Give 3 imaginative English scene ideas for a wondrous, visually rich AI video." },
  { key:"style",     label:"Style visuel ou ambiance", placeholder:"Ex: Po√©tique pastel, Disney, Tim Burton, Pixar, Ghibli...", info:"Inspiration visuelle ou r√©alisateurs.", suggest:"Suggest 3 visual styles or moods for a scene. Include inspirations like Pixar, Ghibli, Tim Burton or Disney." },
  { key:"location",  label:"D√©cor / lieu", placeholder:"Ex: Vieille serre envahie par la nature", info:"Lieu ou environnement principal.", suggest:"Give a list of 5 unique settings/locations for an animated video." },
  { key:"camera",    label:"Cin√©matographie", placeholder:"Ex: Travel avant lent, plan large, lumi√®re douce", info:"Mouvement, objectif, palette...", suggest:"Give 4 cinematography/camera styles for a film scene (shot type, movement, palette, lens)." },
  { key:"action",    label:"Action ou mouvement principal", placeholder:"Ex: Le robot avance et cueille une fleur lumineuse", info:"Que font tes personnages¬†?", suggest:"Suggest 3 visual actions or movements for this video scene." },
  { key:"avatars",   label:"Avatars, personnages", placeholder:"Ex: Petit robot √©merveill√©, oiseaux r√©tro", info:"Qui incarne la sc√®ne¬†?", suggest:"Suggest 4 unique avatars or character types for a magical scene." },
  { key:"lighting",  label:"Lumi√®re et atmosph√®re", placeholder:"Ex: Brume matinale, rayons dor√©s", info:"Ambiance lumineuse et climat.", suggest:"Suggest 4 lighting and atmosphere combinations for dreamy video shots." },
  { key:"sound",     label:"Ambiance sonore (optionnel)", placeholder:"Ex: Oiseaux lointains, vitre qui grince", info:"Bruitage, ambiance ou musique.", suggest:"Suggest 3 ambient soundscapes for a poetic animated film scene." },
  { key:"fx",        label:"Effets sp√©ciaux (optionnel)", placeholder:"Ex: Particules lumineuses, auras", info:"Particules, fx, magie...", suggest:"List 3 creative visual FX for a magical film scene." },
  { key:"dialog",    label:"R√©plique ou texte cl√© (optionnel)", placeholder:"Ex: Le robot murmure ¬´¬†C'est la vie¬†?¬†¬ª", info:"Une courte phrase clef, facultative.", suggest:"Suggest 3 short English dialogue lines for a poetic film scene." }
];
let values={}, stepIdx=0, suggestions=[], transitioned=false;
function slideStep(dir) {
  let sec = document.getElementById("stepSection");
  sec.classList.add("fadeOut");
  setTimeout(()=>{showStep(dir);sec.classList.remove("fadeOut");},260);
}
function showStep(dir) {
  transitioned=true;
  let step = steps[stepIdx], area = document.getElementById("stepSection");
  let val = values[step.key]||"";
  let nstep = stepIdx+1, total = steps.length;
  let tips = (step.info) ? `<small>${step.info}</small>` : "";
  let suggHtml = (step.key==="location")
    ? `<ul class="choiceList" id="choicesList"></ul>`
    : `<div class="suggestArea" id="suggestBtns"></div>`;
  area.innerHTML = `<div class="stepnum">√âtape ${nstep} / ${total}</div>
    <label>${step.label}</label>${tips}
    <textarea id="inputField" rows="2" placeholder="${step.placeholder}">${val}</textarea>
    ${suggHtml}
    <div class="navrow">
        <button class="mainbtn" onclick="slideStep('next')">Suivant <span class="icon-nav">&#8594;</span></button>
        <button class="prevbtn" onclick="slideStep('prev')"><span class="icon-nav">&#8592;</span> Pr√©c√©dent</button>
    </div>
    <button class="suggestbtn" style="margin-top:.99em;width:100%;" onclick="getSuggestions()">R√©g√©n√©rer les suggestions IA</button>
    <span id="errorMsg"></span>`;
  transitioned=false;
}
async function getSuggestions() {
  let step = steps[stepIdx];
  document.getElementById('suggestBtns') && (document.getElementById('suggestBtns').innerHTML = '');
  document.getElementById('choicesList') && (document.getElementById('choicesList').innerHTML = '');
  document.getElementById('errorMsg').innerHTML = '';
  try {
    // OpenRouter : payload "messages" style OpenAI
    const payload = {
      model: OPENROUTER_MODEL,
      messages: [{ role: "user", content: step.suggest }],
      max_tokens: 128,
      temperature: 0.8
    };
    const resp = await fetch(OPENROUTER_URL, {
      method: "POST",
      headers: {
        "Authorization": "Bearer " + OPENROUTER_KEY,
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });
    if(!resp.ok) throw "API err";
    let data = await resp.json();
    let content =
      data.choices && data.choices[0].message && data.choices[0].message.content
        ? data.choices[0].message.content
        : "";
    let lines = content.split(/(?:\*\*[^:]+:\*\*|^|\n|\r|- |\d+\.\s*|Suggestion\s*\d+:?)/)
      .map(l=>l.trim()).filter(l=>l && l.length>2);
    suggestions = lines.slice(0, step.key==="location"?6:4);
    if(step.key==="location" && document.getElementById('choicesList')) {
      document.getElementById('choicesList').innerHTML = suggestions.map(s=>
        `<li onclick="pickSuggestionText('${s.replace(/'/g,"\\'")}')">${s}</li>`).join("");
    } else if(document.getElementById('suggestBtns')) {
      document.getElementById('suggestBtns').innerHTML = suggestions.map((s,i)=>
        `<button class="suggestbtn" onclick="pickSuggestion(${i})">${s}</button>`).join("");
    }
    if(suggestions.length==0) document.getElementById('errorMsg').innerHTML = "<span class='erroria'>Pas de suggestion IA. √Ä toi d‚Äôimaginer¬†!</span>";
  } catch (e) {
    document.getElementById('errorMsg').innerHTML = "<span class='erroria'>Pas de suggestion IA. √âcris √† la main, ou r√©essaie plus tard.</span>";
    suggestions = [];
  }
}
function pickSuggestion(idx) { document.getElementById('inputField').value = suggestions[idx]; }
function pickSuggestionText(txt) { document.getElementById('inputField').value = txt; }
function validateStep() { let val = document.getElementById('inputField').value.trim();
  values[steps[stepIdx].key]=val;
  if(stepIdx<steps.length-1) {stepIdx++;slideStep();} else showExport();
}
function backStep() { if(stepIdx > 0) {stepIdx--;slideStep();} }
function showExport() {
  let v=values;
  let output =`Scene idea: ${v.idea}
Visual style & mood: ${v.style}
Setting/location: ${v.location}
Cinematography: ${v.camera}
Action/movement: ${v.action}
Characters/avatars: ${v.avatars}
Lighting & atmosphere: ${v.lighting}
${v.sound ? "Sound/ambience: "+v.sound : ""}
${v.fx ? "Special FX: "+v.fx : ""}
${v.dialog ? "Dialog: "+v.dialog : ""}
Constraints:
- Only describe what is visible on camera.
- Be concrete, visual and concise.
- Do not narrate camera instructions unless critical.
- Use present tense and short sentences.
`;
  let area = document.getElementById("resultSection");
  document.getElementById('stepSection').classList.add('hide');
  area.innerHTML = `<label style="display:block;text-align:center;font-size:1.18em;margin-bottom:.55em;">
    üé¨ Prompt anglais pr√™t pour Sora 2 :</label>
  <textarea id="finalScript" rows="15" style="width:99%;border-radius:1.6em;padding:.7em 1.55em;margin-bottom:.88em;
  font-size:1.09em; box-shadow:0 2px 10px #c4e6ff29; border:1.5px solid #dcf;">${output}</textarea>
  <button class="exportbtn" onclick="copyExport()">üìã Copier ce prompt</button>
  <button class="prevbtn" onclick="backToEditor()">‚Üê Revenir √† l‚Äô√©dition</button>
  `;
  area.classList.remove('hide');
}
function copyExport() {let s=document.getElementById('finalScript');s.select();document.execCommand("copy");}
function backToEditor() {document.getElementById('resultSection').classList.add('hide');stepIdx=steps.length-1;slideStep();}
window.onload=showStep;
</script>
</body>
</html>
